---
// HorizontalScroll.astro
---

<!-- 
<section class="vertical-section">
    <div class="container">
        <h1>Desliza para ver el portfolio</h1>
    </div>
</section> -->
<div id="scroll-wrapper">
    <section id="section_to-pin" class="section_to-pin">
        <div id="section_pin" class="section_pin">
            <div class="content_wrapper collage-intro">
                <div class="quote-card">
                    <p>"El progreso es el resultado de la constancia."</p>
                </div>
                <h2>Mi Historia</h2>
            </div>

            <div class="dense-mosaic">
                <div class="mosaic-item item-1">
                    <span class="label">Barcelona, 2024</span>
                    <div class="img-container">
                        <img
                            src="https://images.unsplash.com/photo-1533130061792-64b345e4a833?q=80&w=1000&auto=format&fit=crop"
                            alt="Work"
                        />
                    </div>
                </div>

                <div class="mosaic-item item-2 grayscale">
                    <div class="img-container portrait">
                        <img
                            src="https://images.unsplash.com/photo-1500648767791-00dcc994a43e?q=80&w=800&auto=format&fit=crop"
                            alt="Portrait"
                        />
                    </div>
                    <span class="label-bottom">Gala, 2024</span>
                </div>

                <div class="mosaic-item item-text">
                    <p>
                        He trabajado incansablemente para que este sueño se haga
                        realidad.
                    </p>
                </div>

                <div class="mosaic-item item-3">
                    <div class="img-container wide">
                        <img
                            src="https://images.unsplash.com/photo-1568605117036-5fe5e7bab0b7?q=80&w=1000&auto=format&fit=crop"
                            alt="Car"
                        />
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>

<section class="vertical-section footer-area">
    <div class="container">
        <h2>Contacto</h2>
        <p>¿Tienes algún proyecto en mente?</p>
    </div>
</section>

<style>
    :global(body) {
        margin: 0;
        background-color: #f8f7f2; /* Color crema de la referencia */
        overflow-x: hidden;
    }

    /* Secciones verticales estándar */
    .vertical-section {
        height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #ffffff;
        z-index: 10;
        position: relative;
    }

    /* Configuración del Pinning */
    .section_to-pin {
        height: 100vh;
        overflow: hidden;
    }

    .section_pin {
        height: 100vh;
        display: flex;
        align-items: center;
        width: fit-content;
        padding: 0 5vw;
        will-change: transform;
    }

    /* Estilos del Mosaico */
    .dense-mosaic {
        position: relative;
        width: 150vw; /* Ancho del recorrido horizontal */
        height: 80vh;
    }

    .mosaic-item {
        position: absolute;
    }

    .item-1 {
        top: 10%;
        left: 5%;
        width: 450px;
    }
    .item-2 {
        top: 5%;
        left: 40%;
        width: 300px;
    }
    .item-text {
        top: 60%;
        left: 15%;
        width: 300px;
        font-style: italic;
    }
    .item-3 {
        top: 20%;
        left: 70%;
        width: 550px;
    }

    .img-container img {
        width: 100%;
        height: auto;
        display: block;
    }

    .grayscale {
        filter: grayscale(100%);
    }
    .label {
        font-size: 0.7rem;
        text-transform: uppercase;
        color: #888;
    }
</style>

<script>
    import gsap from "gsap";
    import { ScrollTrigger } from "gsap/ScrollTrigger";
    import Lenis from "@studio-freight/lenis";

    gsap.registerPlugin(ScrollTrigger);

    function init() {
        // 1. Scroll suave con Lenis
        const lenis = new Lenis();
        lenis.on("scroll", ScrollTrigger.update);
        gsap.ticker.add((time) => lenis.raf(time * 1000));

        const sectionPin = document.querySelector(
            "#section_pin",
        ) as HTMLElement;
        const sectionToPin = document.querySelector(
            "#section_to-pin",
        ) as HTMLElement;

        if (sectionPin && sectionToPin) {
            // 2. Animación Horizontal con Pinning
            gsap.to(sectionPin, {
                x: () =>
                    -(
                        sectionPin.scrollWidth -
                        document.documentElement.clientWidth
                    ),
                ease: "none",
                scrollTrigger: {
                    trigger: sectionToPin,
                    pin: true, // Bloquea el scroll vertical
                    scrub: 1, // Sincroniza con el movimiento del mouse
                    start: "top top", // Empieza cuando el div llega arriba
                    end: () => "+=" + sectionPin.scrollWidth, // Dura lo que mide el contenido
                    invalidateOnRefresh: true,
                },
            });
        }
    }

    document.addEventListener("DOMContentLoaded", init);
</script>
